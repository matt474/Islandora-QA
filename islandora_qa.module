<?php

/**
 * @file
 * A QA Workflow
 *
 */

define('ISLANDORA_QA_STATUS__NOT_DONE', 0);
define('ISLANDORA_QA_STATUS__DONE', 1);
define('ISLANDORA_QA_STATUS__REJECTED', 2);

/**
 * Implements hook_menu().
 */
function islandora_qa_menu() {
  $items = array();
  
  $items['admin/islandora/tools/qa'] = array(
    'title' => 'Islandora QA',
    'description' => 'Setup a workflow for QA',
    'page callback' => 'drupal_get_form',
    'access arguments' => array('administer site configuration'),
    'page arguments' => array('islandora_qa_task_creation_form'),
    'file' => 'includes/creation.form.inc',
    'type' => MENU_NORMAL_ITEM,
  );
  
  $items['islandora_qa/task/%'] = array(
    'title' => 'Task @item',
    'title arguments' => array('@item' => 2),
    'page callback' => 'islandora_qa_task_page_callback',
    'page arguments' => array(2),
    'access callback' => 'islandora_qa_task_work',
    'file' => 'includes/tasks.inc',
  );
  
  $items['islandora_qa/task/%/reject/%'] = array(
    'title' => 'Reject @item',
    'title arguments' => array('@item' => 4),
    'page callback' => 'islandora_qa_task_reject_page_callback',
    'page arguments' => array(2,4),
    'access callback' => 'islandora_qa_task_work',
    'file' => 'includes/tasks.inc',
  );
  
    $items['islandora_qa/task/%/delete'] = array(
    'title' => 'Delete @item',
    'title arguments' => array('@item' => 2),
    'page callback' => 'islandora_qa_task_delete_page_callback',
    'page arguments' => array(2),
    'access callback' => 'islandora_qa_task_edit',
    'file' => 'includes/tasks.inc',
  );
  
  return $items;
}


/**
 * Implements hook_admin_paths_alter().
 */
function islandora_qa_admin_paths_alter(&$paths) {
    $paths['islandora_qa/task/*'] = TRUE;
}


function islandora_qa_task_work() {
  global $user;
  return user_access('islandora qa work on task', $user);
}

function islandora_qa_task_edit() {
  global $user;
  return user_access('islandora qa manage task', $user);
}

/**
 * Implements hook_permission().
 */
function islandora_qa_permission() {
  $perms = array();

  $perms['islandora qa manage task'] = array(
    'title' => t('Islandora QA Task manage'),
    'description' => t('Allow full management of all QA Tasks'),
  );
  
  $perms['islandora qa work on task'] = array(
    'title' => t('Islandora QA Task work'),
    'description' => t('Allow work on any QA Task'),
  );

  return $perms;
}

/**
 * Implements hook_views_api().
 */
function islandora_qa_views_api() {
  return array(
    'api' => 3,
    'path' => drupal_get_path('module', 'islandora_qa') . '/views',
  );
}
